
dnl AB: mostly from kdemultimedia/mpeglib/configure.in.in
AC_DEFUN(AC_BOSON_HAVE_OGG,
[
VORBISLIBS=""
AC_MSG_CHECKING(for ogg/vorbis headers)
ogg_vorbis=no
AC_TRY_COMPILE([
		#include <vorbis/codec.h>
		#include <vorbis/vorbisfile.h>
                ],[
                ],[
                ogg_vorbis=yes
                ])
AC_MSG_RESULT($ogg_vorbis)
if test x$ogg_vorbis = xyes; then
   dnl we need the ogg_vorbis_lib because otherwise we override LIBS !
   AC_CHECK_LIB(vorbisfile,ov_open,ogg_vorbis_lib=yes,
                ogg_vorbis=no,[-lvorbisfile -lvorbis -logg])
fi

dnl Ok, libogg is there. now check whether we have mpeglib with .ogg support
dnl AB: if OGGPlayObject.mcopclass oor libarts_mpeglib.la gets ever renamed we
dnl     will have some trouble. We also don't support any other ogg
dnl     implementation for arts (mpeglib is currently the only one anyway)
dnl UPDATE there are currently other ogg playobjects, too. since mpeglib sucks
dnl anyway (speed,stability) i removed this test.
dnl if test x$ogg_vorbis = xyes; then
dnl    AC_FIND_FILE(mcop/OGGPlayObject.mcopclass, [$kde_libdirs], oggplayobject)
dnl    if test "$oggplayobject" = NO ; then
dnl      AC_MSG_WARN(Your mpeglib installation lacks ogg support. Please
dnl      install kdemultimedia/mpeglib with ogg support in order to hear sounds.)
dnl      ogg_vorbis=no
dnl    fi
dnl fi

if test x$ogg_vorbis = xyes; then
  AC_LANG_SAVE
  AC_LANG_CPLUSPLUS
  bo_save_flags="$CXXFLAGS"
  CXXFLAGS="$CXXFLAGS $all_includes -DOGG_VORBIS=1"
  mpeglib_ogg=no
  AC_MSG_CHECKING(for ogg support in mpeglib)
  AC_TRY_COMPILE([
	#include <mpeglib/oggvorbis/oggFrame.h>
  ],[
	OGGFrame frame();
	return 0;
  ],mpeglib_ogg=yes,mpeglib_ogg=no)
  if test x$mpeglib_ogg = xno ; then
    AC_MSG_WARN(Your mpeglib installation seems not to support ogg files. Please install kdemultimedia/mpeglib with ogg support)
    ogg_vorbis=no
  fi
  AC_MSG_RESULT($mpeglib_ogg)
  CXXFLAGS=$bo_save_flags
  AC_LANG_RESTORE
fi

if test x$ogg_vorbis = xyes; then
   AC_DEFINE(OGG_VORBIS,1,[Define if you have ogg/vorbis installed and mpeglib supports ogg files])
fi
])
AC_BOSON_HAVE_OGG


